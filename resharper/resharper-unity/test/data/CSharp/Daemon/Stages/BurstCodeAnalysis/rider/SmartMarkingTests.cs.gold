using System;
using System.Collections;
using System.Collections.Generic;
using Unity.Burst;
using Unity.Collections;
using Unity.Jobs;
using Unity.Jobs.LowLevel.Unsafe;

namespace Unity
{
    namespace Jobs
    {
        [JobProducerType]
        public interface IJob
        {
            void Execute();
        }

        namespace LowLevel
        {
            namespace Unsafe
            {
                public class JobProducerTypeAttribute : Attribute
                {
                }
            }
        }
    }

    namespace Burst
    {
        public class BurstCompileAttribute : Attribute
        {
        }

        public class BurstDiscardAttribute : Attribute
        {
        }

    }

    namespace Collections
    {
        public struct NativeArray<T> : IDisposable, IEnumerable<T>, IEnumerable, IEquatable<NativeArray<T>>
            where T : struct
        {
            public void Dispose()
            {
                throw new NotImplementedException();
            }

            public IEnumerator<T> GetEnumerator()
            {
                throw new NotImplementedException();
            }

            IEnumerator IEnumerable.GetEnumerator()
            {
                return GetEnumerator();
            }

            public bool Equals(NativeArray<T> other)
            {
                throw new NotImplementedException();
            }
        }
    }
}

namespace SmartMarkingTests
{
    public class SmartMarkingTests
    {
        private class SimpleClass
        {
            public void D()
            {
                var obj = new object();
            }
        }

        [BurstCompile]
        private struct SmartMarkingTest1 : IJob
        {
            |public void Execute()
            {
                F();
            }|(0)

            |private void F()
            {
                var obj = |new object()|(2);
                D();
            }|(1)

            private void D()
            {
                var obj = new object();
            }
        }

        [BurstCompile]
        private struct SmartMarkingTest2 : IJob
        {
            |public void Execute()
            {
                F();
                D();
            }|(3)

            |private void F()
            {
                var obj = |new object()|(5);
                D();
            }|(4)

            |private void D()
            {
                var obj = |new object()|(7);
            }|(6)
        }

        [BurstCompile]
        private struct SmartMarkingTest3 : IJob
        {
            |public void Execute()
            {
                SimpleClass simpleClass = null;
                |simpleClass|(9).D();
            }|(8)
        }
    }
}
---------------------------------------------------------
(0): ReSharper Unity Burst Code Line Marker: Burst compiled code
(1): ReSharper Unity Burst Code Line Marker: Burst compiled code
(2): ReSharper Warning: Burst: Creating a managed type 'Object' is not supported
(3): ReSharper Unity Burst Code Line Marker: Burst compiled code
(4): ReSharper Unity Burst Code Line Marker: Burst compiled code
(5): ReSharper Warning: Burst: Creating a managed type 'Object' is not supported
(6): ReSharper Unity Burst Code Line Marker: Burst compiled code
(7): ReSharper Warning: Burst: Creating a managed type 'Object' is not supported
(8): ReSharper Unity Burst Code Line Marker: Burst compiled code
(9): ReSharper Warning: Burst: Loading managed type 'SimpleClass' is not supported
